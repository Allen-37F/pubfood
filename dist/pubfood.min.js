/*! pubfood v0.1.12 | (c) pubfood | http://pubfood.org/LICENSE.txt */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.pubfood=t()}}(function(){return function t(e,i,r){function o(s,a){if(!i[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(n)return n(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var l=i[s]={exports:{}};e[s][0].call(l.exports,function(t){var i=e[s][1][t];return o(i?i:t)},l,l.exports,t,e,i,r)}return i[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,i){"use strict";function r(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function o(){}var n="function"!=typeof Object.create?"~":!1;o.prototype._events=void 0,o.prototype.listeners=function(t,e){var i=n?n+t:t,r=this._events&&this._events[i];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var o=0,s=r.length,a=new Array(s);s>o;o++)a[o]=r[o].fn;return a},o.prototype.emit=function(t,e,i,r,o,s){var a=n?n+t:t;if(!this._events||!this._events[a])return!1;var u,d,l=this._events[a],p=arguments.length;if("function"==typeof l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),p){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,i),!0;case 4:return l.fn.call(l.context,e,i,r),!0;case 5:return l.fn.call(l.context,e,i,r,o),!0;case 6:return l.fn.call(l.context,e,i,r,o,s),!0}for(d=1,u=new Array(p-1);p>d;d++)u[d-1]=arguments[d];l.fn.apply(l.context,u)}else{var h,c=l.length;for(d=0;c>d;d++)switch(l[d].once&&this.removeListener(t,l[d].fn,void 0,!0),p){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,e);break;case 3:l[d].fn.call(l[d].context,e,i);break;default:if(!u)for(h=1,u=new Array(p-1);p>h;h++)u[h-1]=arguments[h];l[d].fn.apply(l[d].context,u)}}return!0},o.prototype.on=function(t,e,i){var o=new r(e,i||this),s=n?n+t:t;return this._events||(this._events=n?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],o]:this._events[s].push(o):this._events[s]=o,this},o.prototype.once=function(t,e,i){var o=new r(e,i||this,!0),s=n?n+t:t;return this._events||(this._events=n?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],o]:this._events[s].push(o):this._events[s]=o,this},o.prototype.removeListener=function(t,e,i,r){var o=n?n+t:t;if(!this._events||!this._events[o])return this;var s=this._events[o],a=[];if(e)if(s.fn)(s.fn!==e||r&&!s.once||i&&s.context!==i)&&a.push(s);else for(var u=0,d=s.length;d>u;u++)(s[u].fn!==e||r&&!s[u].once||i&&s[u].context!==i)&&a.push(s[u]);return a.length?this._events[o]=1===a.length?a[0]:a:delete this._events[o],this},o.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[n?n+t:t]:this._events=n?{}:Object.create(null),this):this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=n,"undefined"!=typeof e&&(e.exports=o)},{}],2:[function(t,e,i){"use strict";function r(){this.operators=[]}r.prototype.addOperator=function(t){this.operators.push(t)},r.prototype.process=function(t,e){for(var i=t,r=0;r<this.operators.length;r++)i=this.operators[r].process(i,e);return i},e.exports=r},{}],3:[function(t,e,i){"use strict";function r(){this.operators=[]}r.prototype.addOperator=function(t){this.operators.push(t)},r.prototype.process=function(t,e){for(var i=t,r=0;r<this.operators.length;r++)i=this.operators[r].process(i,e);return i},e.exports=r},{}],4:[function(t,e,i){"use strict";function r(t){this.name="OP-"+o.newId(),this.transform=t}var o=t("../util"),n=t("../event"),s=t("../errors");r.validate=function(t){return!!t&&"function"===o.asType(t)},r.withDelegate=function(t){if(!r.validate(t))return null;var e=new r(t);return e},r.prototype.setName=function(t){return this.name=t,this},r.prototype.process=function(t,e){if(!t)return null;var i=this.transform(t,e);return i||n.publish(n.EVENT_TYPE.ERROR,new s("no transform output")),i||null},e.exports=r},{"../errors":5,"../event":6,"../util":16}],5:[function(t,e,i){"use strict";function r(t){this.name=o,this.message=t||"Pubfood integration error.",this.stack=(new Error).stack}var o="PubfoodError";r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r.prototype.name=o,r.prototype.is=function(t){return t&&t.name===o},e.exports=r},{}],6:[function(t,e,i){"use strict";function r(){this.auction_=1,this.observeImmediate_={}}var o=t("./util"),n=t("./logger"),s=t("eventemitter3");r.prototype.EVENT_TYPE={PUBFOOD_API_LOAD:"PUBFOOD_API_LOAD",PUBFOOD_API_START:"PUBFOOD_API_START",BID_LIB_START:"BID_LIB_START",BID_LIB_LOADED:"BID_LIB_LOADED",BID_START:"BID_START",BID_PUSH_NEXT:"BID_PUSH_NEXT",BID_COMPLETE:"BID_COMPLETE",BID_ASSEMBLER:"BID_ASSEMBLER",AUCTION_LIB_START:"AUCTION_LIB_START",AUCTION_LIB_LOADED:"AUCTION_LIB_LOADED",AUCTION_GO:"AUCTION_GO",AUCTION_TRIGGER:"AUCTION_TRIGGER",AUCTION_REFRESH:"AUCTION_REFRESH",AUCTION_COMPLETE:"AUCTION_COMPLETE",AUCTION_POST_RUN:"AUCTION_POST_RUN",ERROR:"ERROR",WARN:"WARN",INVALID:"INVALID"},r.prototype.publish=function(t,e,i){var r=+new Date;return t===this.EVENT_TYPE.PUBFOOD_API_START&&e&&(r=e),n.logEvent(t,arguments),this.emit(t,{ts:r,type:t,eventContext:i||"pubfood",data:e||""})},o["extends"](r,s),r.prototype.emit=function(t){var e=s.prototype.emit.apply(this,arguments);return e&&this.EVENT_TYPE.AUCTION_POST_RUN!==t||(e=!0,this.observeImmediate_[t]=this.observeImmediate_[t]||[],this.observeImmediate_[t].push(Array.prototype.slice.call(arguments,1))),e},r.prototype.on=function(t,e){var i=this.observeImmediate_[t]||null;if(i){for(var r=0;r<i.length;r++)e.apply(this,i[r]);return this}return s.prototype.on.apply(this,arguments)},r.prototype.removeAllListeners=function(){return s.prototype.removeAllListeners.call(this),this.observeImmediate_={},this},e.exports=new r},{"./logger":8,"./util":16,eventemitter3:1}],7:[function(t,e,i){"use strict";var r={name:"",libUri:"",init:function(t,e){},refresh:function(t,e){}};r.optional={refresh:!0};var o={name:"__default__",libUri:" ",init:function(t,e,i){i()},refresh:function(t,e,i){i()}};o.optional={refresh:!0};var n=function(t,e){},s={slot:"",value:"",sizes:[],targeting:{},label:""};s.optional={targeting:!0,label:!0,value:!0};var a={name:"",elementId:"",sizes:[],bidProviders:[]};e.exports={BidDelegate:o,AuctionDelegate:r,SlotConfig:a,BidObject:s,TransformDelegate:n}},{}],8:[function(t,e,i){"use strict";var r={auction:1,history:[],dumpLog:function(t){if(console&&console.log)for(var e=0;e<this.history.length;e++){var i=this.history[e];t?(t=t||"",t.match(/event/)&&i.eventName&&console.log(i)):console.log(i)}},logCall:function(t,e){this.history.push({ts:+new Date,auction:this.auction,functionName:t,args:Array.prototype.slice.call(e)})},logEvent:function(t,e){this.history.push({ts:+new Date,auction:this.auction,eventName:t,args:Array.prototype.slice.call(e)})}};e.exports=r},{}],9:[function(t,e,i){"use strict";function r(t){t&&t.optionalId&&(this.id=t.optionalId),this.prefix=t&&t.hasOwnProperty("prefix")?t.prefix:!0,this.bidCount=0,this.slots=[],this.slotMap={},this.bidProviders={},this.auctionProvider=null,this.bids_=[],this.lateBids_=[],this.bidStatus={},this.inAuction=!1,this.timeout_=-1,this.trigger_=null,this.initDoneTimeout_=2e3,this.processTargetingCounter_=0,this.bidAssembler=new a,this.requestAssembler=new u,this.callbackTimeout_=2e3,this.processCounter_=0}var o=t("../util"),n=t("../model/slot"),s=t("../model/bid"),a=t("../assembler/bidassembler"),u=t("../assembler/requestassembler"),d=t("../assembler/transformoperator"),l=t("../provider/auctionprovider"),p=t("../provider/bidprovider"),h=t("../event");r.prototype.validate=function(t){var e=!0,i={hasAuctionProvider:function(){return!!this.auctionProvider},hasBidProviders:function(){var t=!1;for(var e in this.bidProviders){t=!0;break}return t||h.publish(h.EVENT_TYPE.WARN,{msg:"Warn: no bid providers"}),t},hasSlots:function(){return 0!==this.slots.length},hasAllSlotsBidder:function(){for(var t=[],e=0;e<this.slots.length;e++){var i=this.slots[e];i.bidProviders&&i.bidProviders[0]||t.push(i.name)}return t.length>0&&h.publish(h.EVENT_TYPE.WARN,{msg:"Warn: no bidders - "+t.join(", ")}),0===t.length}};i.hasBidProviders.warn=!0;for(var r in i)if(e=i[r].call(this),e=i[r].warn?!0:e,!e){h.publish(h.EVENT_TYPE.INVALID,{msg:"Failed: "+r});break}return e},r.prototype.timeout=function(t){this.timeout_="number"==typeof t?t:2e3},r.prototype.getTimeout=function(){return this.timeout_},r.prototype.setAuctionProviderCbTimeout=function(t){this.initDoneTimeout_="number"==typeof t?t:2e3},r.prototype.setAuctionTrigger=function(t){this.trigger_=t},r.prototype.startAuction_=function(){h.publish(h.EVENT_TYPE.BID_ASSEMBLER,"AuctionMediator"),this.bidAssembler.process(this.bids_),this.go_()},r.prototype.startTimeout_=function(){return-1!==this.timeout_&&this.timeout_>=0&&setTimeout(o.bind(this.startAuction_,this),this.timeout_),this},r.prototype.triggerAuction_=function(){function t(){this.startAuction_()}return"function"!==o.asType(this.trigger_)?void this.startTimeout_():(this.trigger_.apply(null,[o.bind(t,this)]),this)},r.prototype.pushBid_=function(t){this.inAuction?this.lateBids_.push(t):this.bids_.push(t)},r.prototype.allBiddersDone=function(){var t=!0;for(var e in this.bidStatus)if(!this.bidStatus[e]){t=!1;break}return t},r.prototype.checkBids_=function(){this.allBiddersDone()&&this.startAuction_()},r.prototype.go_=function(){this.inAuction||(this.inAuction=!0,this.processTargeting_())},r.prototype.getBidKey=function(t){return(this.prefix&&t.provider?t.provider+"_":"")+(t.label||"bid")},r.prototype.mergeKeys=function(t,e){t=o.mergeToObject(t,e)},r.prototype.getSlotBids=function(t){for(var e=[],i=0;i<this.bids_.length;i++){var r=this.bids_[i];r.slot&&r.slot===t&&e.push(r)}return e},r.prototype.buildTargeting_=function(){for(var t=[],e=0;e<this.slots.length;e++){for(var i=this.slots[e],r={type:"slot",name:i.name,id:i.id,elementId:i.elementId||"",sizes:i.sizes,bids:[],targeting:{}},o=this.getSlotBids(i.name),n=0;n<o.length;n++){var s=o[n];r.bids.push({value:s.value||"",provider:s.provider,id:s.id,targeting:s.targeting});var a=this.getBidKey(s);r.targeting[a]=r.targeting[a]||s.value||"",this.mergeKeys(r.targeting,s.targeting)}t.push(r)}return t},r.prototype.processTargeting_=function(){var t=this,e=!1,i=t.auctionProvider.name;t.processTargetingCounter_++;var r=function(){e||(e=!0,t.auctionDone(i))};setTimeout(function(){e||(h.publish(h.EVENT_TYPE.WARN,'Warning: The auction done callback for "'+i+"\" hasn't been called within the allotted time ("+t.initDoneTimeout_/1e3+"sec)"),r())},t.initDoneTimeout_),h.publish(h.EVENT_TYPE.AUCTION_GO,i);var o=t.buildTargeting_();1===t.processTargetingCounter_?t.auctionProvider.init(o,r):t.auctionProvider.refresh(o,r)},r.prototype.auctionDone=function(t){h.publish(h.EVENT_TYPE.AUCTION_COMPLETE,t),setTimeout(function(){h.publish(h.EVENT_TYPE.AUCTION_POST_RUN,t)},0)},r.prototype.addSlot=function(t){var e=n.fromObject(t);return e?(this.slots.push(e),this.slotMap[e.name]=e):h.publish(h.EVENT_TYPE.WARN,"Invalid slot object: "+JSON.stringify(t||{})),e},r.prototype.addBidProvider=function(t){var e=p.withDelegate(t);return e?this.bidProviders[e.name]?h.publish(h.EVENT_TYPE.WARN,"Warning: bid provider "+e.name+" is already added"):this.bidProviders[e.name]=e:h.publish(h.EVENT_TYPE.WARN,"Warning: invalid bid provider: "+t.name),e},r.prototype.bidProviderExists_=function(t){return!!this.bidProviders[t]},r.prototype.setBidProviderCbTimeout=function(t){this.setBidProviderCbTimeout(t)},r.prototype.setAuctionProvider=function(t){this.auctionProvider&&h.publish(h.EVENT_TYPE.WARN,"Warning: auction provider exists: "+this.auctionProvider.name);var e=l.withDelegate(t);return e?(this.auctionProvider=e,this.auctionProvider.setMediator(this)):h.publish(h.EVENT_TYPE.WARN,"Warning: invalid auction provider: "+t.name),e},r.prototype.addRequestTransform=function(t){return this.requestAssembler.addOperator(new d(t)),this},r.prototype.addBidTransform=function(t){return this.bidAssembler.addOperator(new d(t)),this},r.prototype.loadProviders=function(t){var e,i=[];for(var r in this.bidProviders)i.push(r);t&&o.randomize(i);for(var n=0;n<i.length;n++){var s=i[n];if(this.bidProviders[s].libUri){e=this.bidProviders[s].libUri()||"";var a=this.bidProviders[s].sync();o.loadUri(e,a)}}this.auctionProvider&&this.auctionProvider.libUri()&&(h.publish(h.EVENT_TYPE.AUCTION_LIB_LOADED,this.auctionProvider.name),e=this.auctionProvider.libUri(),o.loadUri(e))},r.prototype.getBidderSlots=function(){var t,e,i={},r=[];for(t=0;t<this.slots.length;t++){var o=this.slots[t];for(e=0;e<o.bidProviders.length;e++){var n=o.bidProviders[e],s=i[n]=i[n]||[];s.push(o)}}for(e in i)this.bidProviders[e]&&(r.push({provider:this.bidProviders[e]||{},slots:i[e]}),this.bidStatus[e]=!1);return r},r.prototype.start=function(t){this.triggerAuction_(),this.loadProviders(t);var e=this.getBidderSlots();return this.processBids(e),this},r.prototype.refresh=function(t){if(o.isArray(t)){var e,i,r=this;for(this.slots=[],e=0;e<t.length;e++)i=t[e],this.slotMap[i]?this.slots.push(this.slotMap[i]):h.publish(h.EVENT_TYPE.WARN,"Can't refresh slot \""+i+"\", because it wasn't defined");if(this.slots.length>0){var n=this.auctionProvider.name;h.publish(h.EVENT_TYPE.AUCTION_REFRESH,n),this.bids_=[],this.lateBids_=[];var s=this.getBidderSlots();this.processBids(s);var a=!1,u=function(){a||(a=!0,r.auctionDone(n))};setTimeout(function(){a||(h.publish(h.EVENT_TYPE.WARN,'Warning: The auction done callback for "'+n+"\" hasn't been called within the allotted time ("+r.initDoneTimeout_/1e3+"sec)"),u())},this.initDoneTimeout_);var d=this.buildTargeting_();this.auctionProvider.refresh(d,u)}}else h.publish(h.EVENT_TYPE.WARN,'Invalid data structure, "refresh" accepts an array of strings (slot names)');return this},r.prototype.processBids=function(t){this.processCounter_++;for(var e in t)this.getBids_(t[e].provider,t[e].slots)},r.prototype.setBidProviderCbTimeout=function(t){this.callbackTimeout_="number"==typeof t?t:2e3},r.prototype.getBids_=function(t,e){var i=this,r=t.name,o=!1,n=function(t){i.pushBid(t,r)},s=function(){o||(o=!0,i.doneBid(r))};setTimeout(function(){o||(h.publish(h.EVENT_TYPE.WARN,'Warning: The bid done callback for "'+r+"\" hasn't been called within the allotted time (2sec)"),s())},this.callbackTimeout_),h.publish(h.EVENT_TYPE.BID_START,r),1===this.processCounter_?t.init(e,n,s):t.refresh(e,n,s)},r.prototype.pushBid=function(t,e){var i=s.fromObject(t);i?(i.provider=e,h.publish(h.EVENT_TYPE.BID_PUSH_NEXT,i),this.pushBid_(i)):h.publish(h.EVENT_TYPE.WARN,"Invalid bid object: "+JSON.stringify(t||{}))},r.prototype.doneBid=function(t){h.publish(h.EVENT_TYPE.BID_COMPLETE,t),this.bidStatus[t]=!0,this.checkBids_()},e.exports=r},{"../assembler/bidassembler":2,"../assembler/requestassembler":3,"../assembler/transformoperator":4,"../event":6,"../model/bid":10,"../model/slot":11,"../provider/auctionprovider":12,"../provider/bidprovider":13,"../util":16}],10:[function(t,e,i){"use strict";function r(t,e,i){this.init_&&this.init_(),this.sizes=i,this.slot=t,this.value=e,this.type=o.asType(this.value),this.label,this.provider}var o=t("../util"),n=t("../pubfoodobject"),s=t("../interfaces").BidObject;r.validate=function(t){return t?o.validate(s,t):!1},r.fromObject=function(t){if(!r.validate(t))return null;var e=new r;for(var i in t)"function"===o.asType(e[i])?e[i](t[i]):e[i]=t[i];var n=o.asType(e.value);return e.type="undefined"!==n?n:"",e},r.prototype.setValue=function(t){return this.value=t||"",this.type=o.asType(this.value),this},r.prototype.addSize=function(t,e){var i=Math.abs(~~t),r=Math.abs(~~e);return this.sizes.push([i,r]),this},o["extends"](r,n),e.exports=r},{"../interfaces":7,"../pubfoodobject":15,"../util":16}],11:[function(t,e,i){"use strict";function r(t,e){this.init_&&this.init_(),this.name=t,this.elementId=e,this.bidProviders=[],this.sizes=[]}var o=t("../util"),n=t("../pubfoodobject"),s=t("../interfaces").SlotConfig;r.validate=function(t){return t?o.validate(s,t):!1},r.fromObject=function(t){if(!r.validate(t))return null;var e=new r;for(var i in t)e[i]=t[i];return e},r.prototype.addSizes=function(t){return Array.prototype.push.apply(this.sizes,t),this},r.prototype.addSize=function(t,e){var i=Math.abs(~~t),r=Math.abs(~~e);return this.sizes.push([i,r]),this},r.prototype.addBidProvider=function(t){return this.bidProviders.push(t),this},o["extends"](r,n),e.exports=r},{"../interfaces":7,"../pubfoodobject":15,"../util":16}],12:[function(t,e,i){"use strict";function r(t){this.init_&&this.init_();var e=t||{};this.name=e.name||"",this.slots_=[],this.auctionDelegate=e,this.mediator=null}var o=t("../util"),n=t("../interfaces").AuctionDelegate,s=t("../event"),a=t("../pubfoodobject");r.prototype.setMediator=function(t){this.mediator=t},r.withDelegate=function(t){if(!r.validate(t))return s.publish(s.EVENT_TYPE.INVALID,{msg:"Warn: invalid auction delegate - "+(t&&JSON.stringify(t))||""}),null;var e=new r(t);return e},r.validate=function(t){return o.validate(n,t)},r.prototype.libUri=function(){return this.auctionDelegate.libUri},r.prototype.init=function(t,e){this.auctionDelegate.init(t,e)},r.prototype.refresh=function(t,e){var i=this.auctionDelegate&&this.auctionDelegate.refresh||null;return i?void i(t,e):void s.publish(s.EVENT_TYPE.WARN,"AuctionProvider.auctionDelegate.refresh not defined.")},o["extends"](r,a),e.exports=r},{"../event":6,"../interfaces":7,"../pubfoodobject":15,"../util":16}],13:[function(t,e,i){"use strict";function r(t){this.init_&&this.init_();var e=t||{};this.name=e.name||"",this.bidDelegate=e}var o=t("../util"),n=t("../interfaces").BidDelegate,s=t("../event"),a=t("../pubfoodobject");r.withDelegate=function(t){if(!r.validate(t))return s.publish(s.EVENT_TYPE.WARN,{msg:"Warn: invalid bidder delegate - "+t||""}),null;var e=new r(t);return e},r.validate=function(t){return o.validate(n,t)},r.prototype.libUri=function(t){return t&&(this.bidDelegate.libUri=t),this.bidDelegate.libUri},r.prototype.sync=function(){var t=Array.prototype.slice.call(arguments);return t.length>0&&"boolean"===o.asType(t[0])&&(this.bidDelegate.sync=t[0]),!!this.bidDelegate.sync},r.prototype.init=function(t,e,i){this.bidDelegate.init(t,e,i)},r.prototype.refresh=function(t,e,i){var r=this.bidDelegate&&this.bidDelegate.refresh||null;return r?void r(t,e,i):void s.publish(s.EVENT_TYPE.WARN,"BidProvider.bidDelegate.refresh not defined.")},o["extends"](r,a),e.exports=r},{"../event":6,"../interfaces":7,"../pubfoodobject":15,"../util":16}],14:[function(t,e,i){"use strict";var r=t("./event"),o=t("./util"),n=t("./logger"),s=t("./interfaces").BidDelegate,a=t("./mediator/auctionmediator");!function(t,i,r){t&&(e.exports=r(t,t.pfConfig||{}))}(window||{},void 0,function(e){if(e.pubfood)return e.pubfood.library.logger.logEvent(r.EVENT_TYPE.WARN,["multiple api load"]),e.pubfood;var i=function(t){return new i.library.init(t)},u=[],d={addSlot:0,setAuctionProvider:0,addBidProvider:0};i.library=i.prototype={version:"0.1.12",PubfoodError:t("./errors"),logger:n};var l=function(t){var e=t.getBidProviders();for(var i in d)0===d[i]&&u.push('"'+i+'" was not called');for(var r=t.getSlots(),o=0;o<r.length;o++)for(var n=0;n<r[o].bidProviders.length;n++){var s=r[o].bidProviders[n];e[s]||u.push('No configuration found for bid provider "'+s+'"')}return{hasError:u.length>0,details:u}},p=i.library.init=function(t){return r.publish(r.EVENT_TYPE.PUBFOOD_API_LOAD),n.logCall("api.init",arguments),this.EVENT_TYPE=r.EVENT_TYPE,this.logger=n,t&&(this.id_=t.id||"",this.auctionProviderTimeout_=t.auctionProviderCbTimeout||2e3,this.bidProviderTimeout_=t.bidProviderCbTimeout||2e3,this.randomizeBidRequests_=!!t.randomizeBidRequests),this.mediator=new a,this};return p.prototype.dumpLog=function(t){this.logger.dumpLog(t)},p.prototype.addSlot=function(t){o.isArray(t.bidProviders)&&0!==t.bidProviders.length||(t.bidProviders=["__default__"],this.mediator.bidProviderExists_("__default__")||this.mediator.addBidProvider(s)),n.logCall("api.addSlot",arguments);var e=this.mediator.addSlot(t);return d.addSlot++,e},p.prototype.getSlots=function(){return n.logCall("api.getSlots",arguments),this.mediator.slots},p.prototype.getSlot=function(t){return n.logCall("api.getSlot",arguments),this.mediator.slotMap[t]},p.prototype.setAuctionProvider=function(t){n.logCall("api.setAuctionProvider",arguments);var e=this.mediator.setAuctionProvider(t);return this.mediator.setAuctionProviderCbTimeout(this.auctionProviderTimeout_),d.setAuctionProvider++,e||u.push("Invalid auction provider config"),e},p.prototype.getAuctionProvider=function(){return n.logCall("api.getAuctionProvider",arguments),this.mediator.auctionProvider},p.prototype.addBidProvider=function(t){n.logCall("api.addBidProvider",arguments);var e=this.mediator.addBidProvider(t);return this.mediator.setBidProviderCbTimeout(this.bidProviderTimeout_),d.addBidProvider++,e||u.push("Invalid bid provider config for "+t.name),"function"==typeof t.init&&3!==t.init.length&&u.push("Bid provider "+t.name+"'s init method requires 3 arguments"),"function"==typeof t.refresh&&3!==t.refresh.length&&u.push("Bid provider "+t.name+"'s refresh method requires 3 arguments"),e},p.prototype.getBidProviders=function(){return n.logCall("api.getBidProviders",arguments),this.mediator.bidProviders},p.prototype.getBidProvider=function(t){return n.logCall("api.getBidProvider",arguments),this.mediator.bidProviders[t]},p.prototype.observe=function(t,e){if(n.logCall("api.observe",arguments),"function"==typeof t)for(var i in r.EVENT_TYPE)r.on(r.EVENT_TYPE[i],o.bind(t,this));else"string"==typeof t&&(r.EVENT_TYPE[t]?r.on(r.EVENT_TYPE[t],o.bind(e,this)):r.publish(r.EVENT_TYPE.WARN,'Warning: Invalid event type "'+t+'"'));return this},p.prototype.timeout=function(t){return n.logCall("api.timeout",arguments),this.mediator.timeout(t),this},p.prototype.setAuctionTrigger=function(t){return n.logCall("api.setAuctionTrigger",arguments),this.mediator.setAuctionTrigger(t),this},p.prototype.addBidTransform=function(t){return n.logCall("api.addBidTransform",arguments),this.mediator.addBidTransform(t),this},p.prototype.addRequestTransform=function(t){return n.logCall("api.addRequestTransform",arguments),this.mediator.addRequestTransform(t),this},p.prototype.start=function(t,e){r.publish(r.EVENT_TYPE.PUBFOOD_API_START,t),n.logCall("api.start",arguments);var i=l(this);return"function"==typeof e&&e(i.hasError,i.details),i.hasError||this.mediator.start(this.randomizeBidRequests_),this},p.prototype.refresh=function(t){return n.auction++,n.logCall("api.refresh",arguments),this.mediator.refresh(t),this},p.prototype.library=i.library,e.pubfood=i,i})},{"./errors":5,"./event":6,"./interfaces":7,"./logger":8,"./mediator/auctionmediator":9,"./util":16}],15:[function(t,e,i){"use strict";function r(){this.id=o.newId(),this.params_={}}var o=t("./util");r.prototype.setParam=function(t,e){var i=o.asType(t);return"object"!==i&&"array"!==i&&"function"!==i&&"undefined"!==i&&(this.params_[t]=e),this},r.prototype.getParam=function(t){return this.params_[t]},r.prototype.getParamKeys=function(){var t=[];for(var e in this.params_)t.push(this.params_[e]);return t},e.exports=r},{"./util":16}],16:[function(t,e,i){"use strict";var r={asType:function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},newId:function(){return(+new Date).toString(36)+"xxxxxxxxxx".replace(/[x]/g,function(){return(0|36*Math.random()).toString(36)})},"extends":function(t,e){for(var i in e.prototype)t.prototype[i]=e.prototype[i];t.prototype.parents=t.prototype.parents||[],t.prototype.parents.push(function(){return e}),t.prototype.init_=function(){var t=this.parents||[];for(var e in t)t[e]().call(this)}},hasFunctions:function(t,e){if(!t)return!1;for(var i=!0,o=0;o<e.length;o++){var n=e[o];if(!t[n]||"function"===!r.asType(t[n])){i=!1;break}}return i},loadUri:function(t,e){var i=document,r=t||"";if(e)if("complete"===i.readyState||"loaded"===i.readyState);else try{i.write('<script src="'+r+'"></script>')}catch(o){}else{var n=document.createElement("script");n.async=!0,n.src=r,(i.head||i.body||i.documentElement).appendChild(n)}},bind:function(t,e){return function(){t.apply(e,Array.prototype.slice.call(arguments))}},mergeToObject:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(this.isObject(e[i])?(t[i]||(t[i]={}),this.mergeToObject(t[i],e[i])):this.isArray(e[i])?(t[i]||(t[i]=[]),this.mergeToArray(t[i],e[i])):t[i]=e[i]);return t},mergeToArray:function(t,e){for(var i=0;i<e.length;i++)t.push(this.clone(e[i]));return t},isArray:function(t){return!!t&&"array"===this.asType(t)},isObject:function(t){return!!t&&"object"===this.asType(t)},clone:function(t){return this.isObject(t)?this.cloneObject(t):this.isArray(t)?this.cloneArray(t):t},cloneArray:function(t){return this.mergeToArray([],t)},cloneObject:function(t){return this.mergeToObject({},t)},values:function(t){var e=[];for(var i in t)e.push(t[i]);return e},validate:function(t,e){if(!e)return!1;var i=0;for(var o in t)if("optional"!==o){var n=!!t.optional&&!!t.optional[o],s=e.hasOwnProperty(o),a=this.asType(e[o]),u=!e.init,d=!0;if(("null"===a||"undefined"===a||"number"===a&&!isFinite(e[o])||"string"===a&&""===e[o])&&(d=!1),n||s&&d||++i,d&&u&&r.isArray(e[o])&&0===e[o].length&&++i,d&&!u&&r.asType(e[o])!==r.asType(t[o])&&++i,i>0)break}return!i}};r.randomize=function(t){for(var e,i,r=t.length;r;)i=Math.floor(Math.random()*r--),e=t[r],t[r]=t[i],t[i]=e;return t},e.exports=r},{}]},{},[14])(14)});