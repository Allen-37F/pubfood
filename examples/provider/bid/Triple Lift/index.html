<!DOCTYPE HTML>
<html lang="en-us">
<head>
<script src="./pubfood.js"></script>
<script>

  window.auctionProviderOne = window.auctionProviderOne || {};
  auctionProviderOne.cmd = auctionProviderOne.cmd || [];

  window.TLX = window.TLX || {};
  TLX.cmd = TLX.cmd || [];

  var food = new pubfood();
  food.addSlot({
    name: '/22979003/PF_Test',
    elementId: 'pub_food_div',
    sizes: [[1,1]],
    bidProviders: ['TLX'],
    tlxInvCode: 'headerbidding_placement'
  });
  food.addBidProvider({
    name: 'TLX',
    libUri: './TLX_Bidder.js',
    init: function(slots, pushBid, done) {
      TLX.cmd.push(function() {
        TLX.init(slots)
        var res = TLX.getResults();
        for (key in res){
          pushBid({
            slot: res[key].callback_id,
            value: res[key].cpm,
            sizes: [res[key].width, res[key].height]
          });
                done();
        }
      });
    },
    refresh: function(slots, pushBid, done) {
    }
  });
food.setAuctionProvider({
    name: 'googletag',
    libUri: '//www.googletagservices.com/tag/js/gpt.js',
    init: function(bids, done) {
      googletag.cmd.push(function() {
       // debugger;
        var i, key;
        for (i = 0; i < bids.length; i++) {
          var bid = bids[i];
          if (bid.type === 'page') {
            // set page level targeting
            for (key in bid.targeting) {
              googletag.setTargeting(key, bid.targeting[key]);
            }
          }
          if (bid.type === 'slot') {
            var apSlot = googletag.defineSlot(bid.name, bid.sizes, bid.elementId);
            // set slot level targeting
            for (key in bid.targeting) {
             // debugger;
              apSlot.setTargeting(key, bid.targeting[key]);
            }
            apSlot.addService(googletag.pubads());
          }
        }
      });
      googletag.cmd.push(function() {
        googletag.pubads().enableSingleRequest();
        googletag.enableServices();
      });
      done();
    },
    refresh: function(bids, done) {
    }
  });

  food.timeout(1500);
  food.observe(function(ev) {
    console.log(ev);
  });
  food.start();
</script>

</head>
<body>

<!-- /22979003/PF_Test -->
<div id='pub_food_div'>
  <script>
  food.observe('AUCTION_POST_RUN', function() {
          googletag.cmd.push(function() {
           // debugger;
            googletag.display('pub_food_div');
          });
   });
  </script>
</div>

</body>
</html>