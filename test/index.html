<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="../node_modules/mocha/mocha.css" />
        <title>Pubfood Tests</title>
    </head>
    <body>

        <div id="mocha"></div>

        <script src="../node_modules/mocha/mocha.js"></script>
        <script src="../node_modules/chai/chai.js"></script>
        <!-- jQuery for testing purposes only -->
        <script src="../test/assets/vendor/jquery.js"></script>

        <!-- For testing sync load pubfood -->
        <script src="../dist/pubfood.js"></script>

        <script type="text/javascript">
         mocha.ui('bdd');
        </script>

        <script type="text/javascript">

         // ToDo: Separate concerns and load tests via script elements
         var assert = chai.assert;
         var expect = chai.expect;

         describe('Pubfood - Tests', function () {

             afterEach(function () {

             });

             describe('Pubfood library setup', function testPubfoodSetup() {
                 it('will have a namespace', function() {
                     assert.isDefined(window.pubfood, 'pubfood is undefined');
                 });

                 it('will have a library property', function() {
                     assert.isDefined(window.pubfood.library, 'pubfood.library is undefined');
                 });

                 it('will have a library.model property', function() {
                     assert.isDefined(window.pubfood.library.model, 'pubfood.library.model is undefined');
                 });
             });

             describe('BaseModelObject', function testBaseModelObject() {
                 it('will have a generated Id', function() {
                     var modelObject = new pubfood.library.model.BaseModelObject();
                 });
             });
             describe('Model builder will build a Slot', function testSlotBuilder() {

                 var slotModel = {
                     name: 'right-rail',
                     dimensions: [ [300, 250], [300, 600] ]
                 }

                 it('with an internal id', function() {
                     var slot = pubfood.library.model.slotBuilder();
                     assert.isDefined(slot.id, 'id is not defined');
                     assert.match(slot.id, /[\w]+$/, 'id is not an ascii string');
                 });

                 it('with a name', function() {
                     var slot = pubfood.library.model.slotBuilder().name(slotModel.name);
                     assert.equal(slot.name, slotModel.name, 'slot name not set');
                 });

                 it('with a dimensions array', function() {
                     var slot = pubfood.library.model.slotBuilder(),
                         i = 0,
                         dim = slotModel.dimensions;

                     for (i; i < dim.length; i++) {
                         var width = dim[i][0];
                         var height = dim[i][1];
                         slot.dimension(width, height);
                     }
                     assert.deepEqual(slot.getDimensions(), slotModel.dimensions, 'slot dimensions not set');
                 });

                 it('with a name and dimensions in fluent chain', function() {
                     var slot = pubfood.library.model.slotBuilder().
                                        name('right-rail').
                                        dimension(300, 250).
                                        dimension(300, 600);
                     assert.equal(slot.name, slotModel.name, 'slot name not set');
                     assert.deepEqual(slot.getDimensions(), slotModel.dimensions, 'slot dimensions not set');
                 });

                 it('with String dimension arguments', function() {
                         var slot = pubfood.library.model.slotBuilder()
                                           .dimension('300', '250');
                     assert.deepEqual(slot.getDimensions(), [ [300, 250] ], 'dimensions not equal');
                 });
             });

             describe('Model builder will build a Bid', function testBidBuilder() {

                 var bidModel = {
                     value: 3.75,
                     type: 'number',
                     slot: 'right-rail',
                     dimensions: [ [300, 250], [300, 600] ],
                     provider: 'foobar'
                 };

                 it('with an internal Id', function() {
                     var slot = pubfood.library.model.bidBuilder();
                     assert.isDefined(slot.id, 'id is not defined');
                     assert.match(slot.id, /[\w]+$/, 'id is not an ascii string');
                 });

                 it('with a value and type', function() {

                     var bidValues = [
                         { v: 3, t: 'number' },
                         { v: 1.76, t: 'number'},
                         { v: 'xyz123', t: 'string'},
                         { v: '1.76', t: 'string'}
                     ];

                     for (var i = 0; i < bidValues.length; i++) {

                         var value = bidValues[i].v,
                             type = bidValues[i].t,
                             bid = pubfood.library.model.bidBuilder().
                                           value(value);

                         assert.equal(bid.value, value, 'bid value incorrect');
                         assert.isDefined(bid.type, 'bid type undefined');
                         assert.equal(bid.type, type, 'bid type incorrect');
                     }
                 });

                 it('with a provider, slot name, dimensions and bid value', function() {
                     var bid = pubfood.library.model.bidBuilder().
                                       value(bidModel.value).
                                       dimension(bidModel.dimensions[0][0], bidModel.dimensions[0][1]).
                                       dimension(bidModel.dimensions[1][0], bidModel.dimensions[1][1]).
                                       provider(bidModel.provider);

                     assert.equal(bid.value, bidModel.value, 'bid value incorrect');
                     assert.equal(bid.type, bidModel.type, 'bid type incorrect');
                     assert.equal(bid.provider, bidModel.provider, 'bid provider incorrect');
                     assert.deepEqual(bid.getDimensions(), bidModel.dimensions, 'bid dimensions incorrect');

                 });
             });

             describe('BidProvider', function testFalse() {
                 it('will do stuff', function() {
                     assert.equal(1, 1, 'one not equals one');
                 });
             });
         });

        </script>

        <script>
         onload = function() {
             if (window.debugger) {
                 eval('debugger;');
             }
             mocha.run();
         };
        </script>

    </body>
</html>
